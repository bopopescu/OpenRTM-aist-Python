\section{クラス CorbaPort}
\label{classsource__py_1_1_corba_port_1_1_corba_port}\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
RT コンポーネント CORBA provider/consumer 用 Port  


\subsection*{Public メソッド}
\begin{CompactItemize}
\item 
def {\bf \_\-\_\-init\_\-\_\-}
\begin{CompactList}\small\item\em コンストラクタ \item\end{CompactList}\item 
def {\bf registerProvider}
\begin{CompactList}\small\item\em Provider を登録する \item\end{CompactList}\item 
def {\bf registerConsumer}
\begin{CompactList}\small\item\em \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を登録する \item\end{CompactList}\item 
def {\bf publishInterfaces}
\begin{CompactList}\small\item\em Interface 情報を公開する \item\end{CompactList}\item 
def {\bf subscribeInterfaces}
\begin{CompactList}\small\item\em Interface に接続する \item\end{CompactList}\item 
def {\bf unsubscribeInterfaces}
\begin{CompactList}\small\item\em Interface への接続を解除する \item\end{CompactList}\end{CompactItemize}
\subsection*{データ構造}
\begin{CompactItemize}
\item 
class {\bf Consumer}
\begin{CompactList}\small\item\em \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} の情報を格納する構造体 \item\end{CompactList}\item 
class {\bf subscribe}
\begin{CompactList}\small\item\em ConnectorProfile と Consuemr の比較をしオブジェクト参照を セットするための Functor \item\end{CompactList}\item 
class {\bf unsubscribe}
\begin{CompactList}\small\item\em \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} のオブジェクトを解放するための Functor \item\end{CompactList}\end{CompactItemize}


\subsection{説明}
RT コンポーネント CORBA provider/consumer 用 Port 



\footnotesize\begin{verbatim}
\end{verbatim}
\normalsize


\doxyref{CorbaPort}{p.}{classsource__py_1_1_corba_port_1_1_corba_port} は RT コンポーネントにおいて、ユーザ定義の CORBA オブジェクト サービスおよびコンシューマを提供する Port 実装である。 

RT コンポーネントは、Port を介してユーザが定義した CORBA サービスを提供 することができ、これを RT Service (Provider) と呼ぶ。 また、他の RT コンポーネントのサービスを利用するための CORBA オブジェクト のプレースホルダを提供することができ、これを RT Service \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} と呼ぶ。 

\doxyref{CorbaPort}{p.}{classsource__py_1_1_corba_port_1_1_corba_port} は任意の数の Provider および \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を管理することができ、 Port 同士を接続する際に対応する Provider と \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を適切に関連付ける ことができる。 

\doxyref{CorbaPort}{p.}{classsource__py_1_1_corba_port_1_1_corba_port} は通常以下のように利用される。

\small\begin{alltt}
 \# CORBAポートの初期化
 self.\_myServicePort = OpenRTM.CorbaPort("MyService")\end{alltt}
\normalsize 


\small\begin{alltt} // Provider側
 \# この Port が提供する Serivce Provider の初期化
 self.\_mpros = MyServiceSVC\_impl()
 \# Service Provider を Port に登録
 self.\_myServicePort.registerProvider("myservice0", "MyService", self.\_mpros)\end{alltt}
\normalsize 


\small\begin{alltt} // Consumer側
 \# この Port が提供する Serivce \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} の初期化
 self.\_mycons = OpenRTM.CorbaConsumer(interfaceType=\_GlobalIDL.MyService)
 \# Service \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を Port に登録
 self.\_myServicePort.registerConsumer("myservice0", "MyService", self.\_mycons)\end{alltt}
\normalsize 


\small\begin{alltt} \# CORBAポートへの登録
 self.registerPort(self.\_myServicePort)\end{alltt}
\normalsize 


\small\begin{alltt} // connect が行われた後
 self.my\_cons.\_ptr().your\_service\_function(); // YourService の関数をコール\end{alltt}
\normalsize 


\small\begin{alltt} // connect された 別のコンポーネントにおいて
 self.m\_cons1.\_ptr().my\_service\_function(); // MyService の関数をコール
 \end{alltt}
\normalsize 


このように、提供したい Service Provider を \doxyref{registerProvider()}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_048e5b659a1a0b2f47798bfbb5287816} で登録 することにより、他のコンポーネントから利用可能にし、他方、 利用したい Service \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を \doxyref{registerConsumer()}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_6e7e745271f04fd60a4f07824a80466b} で登録することにより 他のコンポーネントの Service をコンポーネント内で利用可能にすることが できる。

\begin{Desc}
\item[から:]0.4.0 \end{Desc}


 CorbaPort.py の 126 行で定義されています。

\subsection{関数}
\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!\_\-\_\-init\_\-\_\-@{\_\-\_\-init\_\-\_\-}}
\index{\_\-\_\-init\_\-\_\-@{\_\-\_\-init\_\-\_\-}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def \_\-\_\-init\_\-\_\- ( {\em self},  {\em name})}\label{classsource__py_1_1_corba_port_1_1_corba_port_c775ee34451fdfa742b318538164070e}


コンストラクタ 

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em name}]Port の名前 \end{description}
\end{Desc}


 CorbaPort.py の 146 行で定義されています。\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!registerProvider@{registerProvider}}
\index{registerProvider@{registerProvider}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def registerProvider ( {\em self},  {\em instance\_\-name},  {\em type\_\-name},  {\em provider})}\label{classsource__py_1_1_corba_port_1_1_corba_port_048e5b659a1a0b2f47798bfbb5287816}


Provider を登録する 

この Port において提供したいサーバントをこの Port に対して登録する。 サーバントは、引数で与えられる instance\_\-name, type\_\-name を、 サーバント自身のインスタンス名およびタイプ名として、サーバントに 関連付けられる。

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em instance\_\-name}]サーバントのインスタンス名 \item[{\em type\_\-name}]サーバントのタイプ名 \item[{\em provider}]CORBA サーバント\end{description}
\end{Desc}
\begin{Desc}
\item[戻り値:]既に同名の instance\_\-name が登録されていれば false を返す。 \end{Desc}


 CorbaPort.py の 187 行で定義されています。\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!registerConsumer@{registerConsumer}}
\index{registerConsumer@{registerConsumer}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def registerConsumer ( {\em self},  {\em instance\_\-name},  {\em type\_\-name},  {\em consumer})}\label{classsource__py_1_1_corba_port_1_1_corba_port_6e7e745271f04fd60a4f07824a80466b}


\doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} を登録する 

この Port が要求するサービスのプレースホルダであるコンシューマ (\doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer}) を登録する。 \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} が関連付けられるサービスのインスタンス名およびタイプ名として、 引数に instance\_\-name, type\_\-name および \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} 自身を与えることにより、 内部でこれらが関連付けられる。 Port 間の接続 (connect) 時 には、同一の instance\_\-name, type\_\-name を持つ サービスが他の Port から提供 (Provide) されている場合、そのサービスの オブジェクト参照が自動的に \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} にセットされる。

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em instance\_\-name}]\doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} が要求するサービスのインスタンス名 \item[{\em type\_\-name}]\doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} が要求するサービスのタイプ名 \item[{\em consumer}]CORBA サービスコンシューマ\end{description}
\end{Desc}
\begin{Desc}
\item[戻り値:]既に同名の instance\_\-name が登録されていれば false を返す。 \end{Desc}


 CorbaPort.py の 241 行で定義されています。\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!publishInterfaces@{publishInterfaces}}
\index{publishInterfaces@{publishInterfaces}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def publishInterfaces ( {\em self},  {\em connector\_\-profile})}\label{classsource__py_1_1_corba_port_1_1_corba_port_cc531607a3c2f8b651a97eb335152647}


Interface 情報を公開する 

この Portが所有する Provider に関する情報を ConnectorProfile::properties に代入する。 代入する情報は、NVListの name と value として以下のものが格納される。

\begin{itemize}
\item port.$<$type\_\-name$>$.$<$instance\_\-name$>$: $<$CORBA::Object\_\-ptr$>$\end{itemize}


ここで、\begin{itemize}
\item $<$type\_\-name$>$: PortInterfaceProfile::type\_\-name\item $<$instance\_\-name$>$: PortInterfaceProfile::instance\_\-name\par
 である。\par
 ConnectorProfile::properties では、これらを .(ドット)表記で、 NameValue のキーとしている。したがって、\end{itemize}


\small\begin{alltt}
  PortInterfaceProfile
  \{
    instance\_name = "PA10\_0";
    type\_name     = "Manipulator";
    polarity      = PROVIDED;
  \}
\end{alltt}
\normalsize 


ならば、

\small\begin{alltt}
 NameValue = \{ "port.Manipulator.PA10\_0": <Object reference>=""> \}
 \end{alltt}
\normalsize 


といった値が ConnectorProfile::properties に格納され、他のポートに対して 伝達される。他の Port でこのインターフェースを使用する \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} が 存在すれば、ConnectorProfile からこのキーからオブジェクトリファレンスを 取得し何らかの形で使用される。

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em connector\_\-profile}]コネクタプロファイル\end{description}
\end{Desc}
\begin{Desc}
\item[戻り値:]ReturnCode\_\-t 型のリターンコード \end{Desc}


 CorbaPort.py の 299 行で定義されています。\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!subscribeInterfaces@{subscribeInterfaces}}
\index{subscribeInterfaces@{subscribeInterfaces}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def subscribeInterfaces ( {\em self},  {\em connector\_\-profile})}\label{classsource__py_1_1_corba_port_1_1_corba_port_9743165933e0fee41ab3b4788dc5b749}


Interface に接続する 

この Portが所有する \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} に適合する Provider に関する情報を ConnectorProfile::properties から抽出し \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} にオブジェクト参照 をセットする。

今、Consumer が \small\begin{alltt}
  PortInterfaceProfile
  \{
    instance\_name = "PA10\_0";
    type\_name     = "Manipulator";
    polarity      = REQUIRED;
  \}
 \end{alltt}
\normalsize 
 として登録されていれば、他の Port の \small\begin{alltt}
  PortInterfaceProfile
  \{
    instance\_name = "PA10\_0";
    type\_name     = "Manipulator";
    polarity      = PROVIDED;
  \}
 \end{alltt}
\normalsize 
 として登録されている Serivce Provider のオブジェクト参照を探し、 \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} にセットする。 実際には、ConnectorProfileproperties に \small\begin{alltt}
 NameValue = \{ "port.Manipulator.PA10\_0": <Object reference>=""> \}
 \end{alltt}
\normalsize 
 として登録されている NameValue を探し、そのオブジェクト参照を \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} にセットする。

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em connector\_\-profile}]コネクタプロファイル\end{description}
\end{Desc}
\begin{Desc}
\item[戻り値:]ReturnCode\_\-t 型のリターンコード \end{Desc}


 CorbaPort.py の 351 行で定義されています。\index{source\_\-py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}!unsubscribeInterfaces@{unsubscribeInterfaces}}
\index{unsubscribeInterfaces@{unsubscribeInterfaces}!source_py::CorbaPort::CorbaPort@{source\_\-py::CorbaPort::CorbaPort}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}def unsubscribeInterfaces ( {\em self},  {\em connector\_\-profile})}\label{classsource__py_1_1_corba_port_1_1_corba_port_3bce9d1fab9e4568c5fcec276767b6dc}


Interface への接続を解除する 

与えられた ConnectorProfile に関連する \doxyref{Consumer}{p.}{classsource__py_1_1_corba_port_1_1_corba_port_1_1_consumer} にセットされた すべての Object を解放し接続を解除する。

\begin{Desc}
\item[引数:]
\begin{description}
\item[{\em self}]\item[{\em connector\_\-profile}]コネクタプロファイル \end{description}
\end{Desc}


 CorbaPort.py の 373 行で定義されています。