#!/usr/bin/env python
# -*- Python -*-

#
#  \file test_PortBase.py
#  \brief test for RTC's Port base class
#  \date $Date: 2007/09/18 $
#  \author Shinji Kurihara
# 
#  Copyright (C) 2006
#      Task-intelligence Research Group,
#      Intelligent Systems Research Institute,
#      National Institute of
#          Advanced Industrial Science and Technology (AIST), Japan
#      All rights reserved.
# 

import sys
sys.path.insert(1,"../")

import unittest
from PortBase import *

import CORBA
import OpenRTM
import RTC, RTC__POA

from omniORB import any



class PortBaseTestClass(PortBase):
	def getUUID(self):
		return OpenRTM.uuid1()

	def publishInterfaces(self, prof):
		return RTC.RTC_OK

	def subscribeInterfaces(self, prof):
		return RTC.RTC_OK

	def unsubscribeInterfaces(self, prof):
		return


class TestClass(unittest.TestCase):
	def setUp(self):
		self._orb = CORBA.ORB_init()
		self._poa = self._orb.resolve_initial_references("RootPOA")
		self._poa._get_the_POAManager().activate()

		self._pb = PortBase()

		pIProf = RTC.PortInterfaceProfile("PortInterfaceProfile-instance_name",
										  "PortInterfaceProfile-type_name",
										  RTC.REQUIRED)
		pIFProfList = [pIProf]

		nv = RTC.NameValue("ConnectorProfile-properties0-name", any.to_any(1.1))
		nvlist = [nv]
		cProf = RTC.ConnectorProfile("ConnectorProfile-name",
									 "connect_id0",
									 [],
									 nvlist)
		
		cProfList = [cProf]

		nv = RTC.NameValue("PortProfile-properties0-name", any.to_any(2.2))
		nvlist = [nv]
		
		pProf = RTC.PortProfile("inport0",
								pIFProfList,
								cProfList,
								nvlist)

		self._pb.setProfile(pProf)


	"""
	def test_get_port_profile(self):
		self._pb.setName("test_connect")
		self._pb.setPortRef(self)
		self._pb.setOwner(self)
		self._pb.appendInterface("test_instance", "PERIODIC", RTC.PROVIDED)
		self._pb.addProperty("name","value")
		prof = self._pb.get_port_profile()
		print prof.name
		print prof.interfaces
		print prof.connector_profiles
		print prof.owner
		print prof.properties
	"""
		


	def test_get_connector_profiles(self):
		nvlist = [OpenRTM.NVUtil.newNV("dataport.interface_type","CORBA_Any"),
				  OpenRTM.NVUtil.newNV("dataport.dataflow_type","Push"),
				  OpenRTM.NVUtil.newNV("dataport.subscription_type","Flush")]

		outp = OutPortObj()
		self._poa.activate_object(outp)
		outp = outp._this().get_ports()
		print "port_list: ", outp

		inp  = InPortObj()
		self._poa.activate_object(inp)
		inp = inp._this().get_ports()
		print "port_list: ", inp
		prof = RTC.ConnectorProfile("connector0",
									"",
									[outp[0],inp[0]],
									nvlist)
		print self._pb.connect(prof)


	"""
	def test_get_connector_profile(self):
		pass


	def test_connect(self):
		nvlist = [OpenRTM.NVUtil.newNV("dataport.interface_type","CORBA_Any"),
				  OpenRTM.NVUtil.newNV("dataport.dataflow_type","Push"),
				  OpenRTM.NVUtil.newNV("dataport.subscription_type","Flush")]

		prof = RTC.ConnectorProfile("connector0","",[TestObj(),TestObj()],nvlist)
		self._pb.connect(prof)


	def test_notify_connect(self):
		pass


	def test_disconnect(self):
		pass


	def test_notify_disconnect(self):
		pass


	def test_disconnect_all(self):
		pass



	def test_getProfile(self):
		pass
    

	def test_getPortRef(self):
		pass


	def test_publishInterfaces(self):
		pass
    

	def test_connectNext(self):
		pass


	def test_disconnectNext(self):
		pass


	def test_subscribeInterfaces(self):
		pass
    
    
	def test_unsubscribeInterfaces(self):
		pass

	def test_isEmptyId(self):
		pass


	def test_getUUID(self):
		pass


	def test_setUUID(self):
		pass


	def test_isExistingConnId(self):
		pass


	def test_findConnProfile(self):
		pass
    

	def test_findConnProfileIndex(self):
		pass


	def test_updateConnectorProfile(self):
		pass


	def test_eraseConnectorProfile(self):
		pass



	def test_deleteInterface(self):
		pass
	"""
    



############### test #################
if __name__ == '__main__':
        unittest.main()
